<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weihnachtlicher Bingo-Karten Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    .float-animation {
      animation: float 3s ease-in-out infinite;
    }
  </style>
</head>
<body class="bg-gradient-to-b from-red-50 via-white to-green-50 min-h-screen p-8">
  <div class="max-w-6xl mx-auto">
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-6xl font-bold text-red-700 mb-2 float-animation" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.1);">
        üéÑ Bingo-Karten Generator üéÑ
      </h1>
      <p class="text-gray-600 text-lg">Erstelle personalisierte Bingo-Karten mit weihnachtlichem Flair</p>
    </div>

    <div class="grid md:grid-cols-2 gap-8">
      <!-- Eingabe-Bereich -->
      <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-red-100 hover:shadow-2xl transition-shadow">
        <h2 class="text-2xl font-bold text-red-700 mb-4 flex items-center gap-2">
          <span class="text-3xl">‚ûï</span>
          Antworten eingeben
        </h2>
        
        <div class="mb-4">
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            Manuelle Eingabe (eine Antwort pro Zeile)
          </label>
          <textarea
            id="answersInput"
            class="w-full h-48 p-3 border-2 border-gray-300 rounded-lg focus:border-red-400 focus:ring-2 focus:ring-red-200 transition-all resize-none"
            placeholder="Geschenke auspacken&#10;Weihnachtslieder singen&#10;Pl√§tzchen backen&#10;Tannenbaum schm√ºcken&#10;Gl√ºhwein trinken&#10;Schneeballschlacht&#10;Adventskranz anz√ºnden&#10;..."
          ></textarea>
        </div>

        <div class="mb-4">
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            Oder Datei hochladen (CSV/TXT)
          </label>
          <label class="flex items-center justify-center gap-2 w-full p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-red-400 hover:bg-red-50 cursor-pointer transition-all">
            <span class="text-2xl">üì§</span>
            <span class="text-gray-600 font-medium">Datei ausw√§hlen</span>
            <input
              type="file"
              id="fileInput"
              accept=".txt,.csv"
              class="hidden"
            />
          </label>
        </div>

        <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-4 border-2 border-green-200">
          <p class="text-sm text-green-800 font-semibold">
            ‚úì <strong id="answerCount" class="text-lg">0</strong> Antworten gefunden
          </p>
        </div>
      </div>

      <!-- Konfigurations-Bereich -->
      <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-green-100 hover:shadow-2xl transition-shadow">
        <h2 class="text-2xl font-bold text-green-700 mb-4 flex items-center gap-2">
          <span class="text-3xl">‚öôÔ∏è</span>
          Konfiguration
        </h2>

        <div class="mb-5">
          <label class="block text-sm font-semibold text-gray-700 mb-3">
            Kartengr√∂√üe
          </label>
          <div class="flex gap-3">
            <button onclick="setGridSize(3)" id="size-3" class="flex-1 py-4 rounded-xl font-bold text-lg transition-all transform hover:scale-105 bg-gray-100 text-gray-700 hover:bg-gray-200 shadow">
              3√ó3
            </button>
            <button onclick="setGridSize(4)" id="size-4" class="flex-1 py-4 rounded-xl font-bold text-lg transition-all transform hover:scale-105 bg-gray-100 text-gray-700 hover:bg-gray-200 shadow">
              4√ó4
            </button>
            <button onclick="setGridSize(5)" id="size-5" class="flex-1 py-4 rounded-xl font-bold text-lg transition-all transform hover:scale-105 bg-gradient-to-r from-green-600 to-emerald-600 text-white shadow-lg">
              5√ó5
            </button>
          </div>
        </div>

        <div class="mb-5">
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            Anzahl der Karten
          </label>
          <input
            type="number"
            id="numCards"
            min="1"
            max="50"
            value="4"
            class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-400 focus:ring-2 focus:ring-green-200 text-lg font-semibold"
          />
        </div>

        <div class="mb-6 bg-blue-50 p-3 rounded-lg border border-blue-200">
          <label class="flex items-center gap-3 cursor-pointer">
            <input
              type="checkbox"
              id="freeSpace"
              checked
              class="w-6 h-6 text-green-600 rounded focus:ring-green-500 cursor-pointer"
            />
            <span class="text-sm font-medium text-gray-700">
              ‚≠ê Freies Feld in der Mitte (nur bei ungerader Gr√∂√üe)
            </span>
          </label>
        </div>

        <button
          onclick="generateCards()"
          id="generateBtn"
          class="w-full bg-gradient-to-r from-red-600 via-pink-600 to-green-600 text-white py-5 rounded-xl font-bold text-xl hover:from-red-700 hover:to-green-700 transition-all shadow-xl transform hover:scale-105"
        >
          ‚ú® Karten generieren ‚ú®
        </button>
      </div>
    </div>

    <!-- Vorschau-Bereich -->
    <div id="previewSection" class="mt-8 hidden">
      <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-yellow-100">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
          <h2 class="text-3xl font-bold text-yellow-700">
            üé® Vorschau (<span id="cardCount">0</span> Karten)
          </h2>
          <button
            onclick="downloadPDF()"
            id="downloadBtn"
            class="flex items-center gap-2 bg-gradient-to-r from-red-600 to-red-700 text-white px-8 py-4 rounded-xl font-bold text-lg hover:from-red-700 hover:to-red-800 transition-all shadow-lg transform hover:scale-105"
          >
            <span class="text-2xl">üì•</span>
            Als PDF herunterladen
          </button>
        </div>

        <div id="previewCards" class="grid md:grid-cols-2 gap-6"></div>
        
        <p id="moreCardsText" class="text-center text-gray-600 mt-6 text-base font-medium hidden"></p>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  
  <script>
    let answerList = [];
    let cards = [];
    let gridSize = 5;

    document.getElementById('fileInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          const text = event.target.result;
          document.getElementById('answersInput').value = text;
          updateAnswerList();
        };
        reader.readAsText(file);
      }
    });

    document.getElementById('answersInput').addEventListener('input', updateAnswerList);

    function updateAnswerList() {
      const text = document.getElementById('answersInput').value;
      answerList = text
        .split('\n')
        .map(line => line.trim())
        .filter(line => line.length > 0);
      
      document.getElementById('answerCount').textContent = answerList.length;
    }

    function setGridSize(size) {
      gridSize = size;
      
      [3, 4, 5].forEach(s => {
        const btn = document.getElementById(`size-${s}`);
        if (s === size) {
          btn.className = 'flex-1 py-4 rounded-xl font-bold text-lg transition-all transform hover:scale-105 bg-gradient-to-r from-green-600 to-emerald-600 text-white shadow-lg';
        } else {
          btn.className = 'flex-1 py-4 rounded-xl font-bold text-lg transition-all transform hover:scale-105 bg-gray-100 text-gray-700 hover:bg-gray-200 shadow';
        }
      });
    }

    function shuffleArray(array) {
      const shuffled = [...array];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    function generateCards() {
      const freeSpace = document.getElementById('freeSpace').checked;
      const numCards = parseInt(document.getElementById('numCards').value) || 4;
      const requiredAnswers = gridSize * gridSize - (freeSpace && gridSize % 2 === 1 ? 1 : 0);
      
      if (answerList.length < requiredAnswers) {
        alert(`Du ben√∂tigst mindestens ${requiredAnswers} Antworten f√ºr ${gridSize}√ó${gridSize} Karten${freeSpace && gridSize % 2 === 1 ? ' (mit freiem Feld)' : ''}.`);
        return;
      }

      cards = [];
      for (let i = 0; i < numCards; i++) {
        const shuffled = shuffleArray(answerList);
        const cardAnswers = shuffled.slice(0, requiredAnswers);
        
        if (freeSpace && gridSize % 2 === 1) {
          const middle = Math.floor(cardAnswers.length / 2);
          cardAnswers.splice(middle, 0, 'FREI');
        }
        
        cards.push(cardAnswers);
      }

      displayPreview();
    }

    function displayPreview() {
      const previewSection = document.getElementById('previewSection');
      const previewCards = document.getElementById('previewCards');
      const cardCount = document.getElementById('cardCount');
      const moreCardsText = document.getElementById('moreCardsText');

      previewSection.classList.remove('hidden');
      cardCount.textContent = cards.length;
      previewCards.innerHTML = '';

      cards.slice(0, 4).forEach((card, index) => {
        const cardDiv = document.createElement('div');
        cardDiv.className = 'border-4 border-red-200 rounded-2xl p-5 bg-gradient-to-br from-red-50 via-pink-50 to-green-50 shadow-lg hover:shadow-xl transition-shadow';
        
        let cellsHTML = '';
        card.forEach(answer => {
          const isFree = answer === 'FREI';
          cellsHTML += `
            <div class="aspect-square flex items-center justify-center text-center p-2 border-2 border-red-300 rounded-lg text-xs font-semibold transition-transform hover:scale-105 ${
              isFree ? 'bg-gradient-to-br from-green-100 to-emerald-100 text-green-700 border-green-400 shadow-inner' : 'bg-white text-gray-800 shadow-sm'
            }">
              ${isFree ? '‚òÖ FREI ‚òÖ' : answer}
            </div>
          `;
        });

        cardDiv.innerHTML = `
          <div class="text-center mb-4">
            <h3 class="text-3xl font-bold text-red-700" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.1);">üéÑ BINGO üéÑ</h3>
            <p class="text-xs text-gray-500 font-medium mt-1">Karte ${index + 1}</p>
          </div>
          <div class="grid gap-2" style="grid-template-columns: repeat(${gridSize}, 1fr);">
            ${cellsHTML}
          </div>
        `;

        previewCards.appendChild(cardDiv);
      });

      if (cards.length > 4) {
        moreCardsText.textContent = `... und ${cards.length - 4} weitere Karten (im PDF enthalten) üéÅ`;
        moreCardsText.classList.remove('hidden');
      } else {
        moreCardsText.classList.add('hidden');
      }
    }

    function downloadPDF() {
      if (!window.jspdf) {
        alert('PDF-Bibliothek l√§dt noch. Bitte einen Moment warten und erneut versuchen.');
        return;
      }

      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();

      cards.forEach((card, cardIndex) => {
        if (cardIndex > 0) {
          pdf.addPage();
        }

        pdf.setFontSize(28);
        pdf.setTextColor(165, 42, 42);
        pdf.text('BINGO', 105, 25, { align: 'center' });

        const margin = 20;
        const gridWidth = 170;
        const cellSize = gridWidth / gridSize;
        const startX = margin;
        const startY = 45;

        pdf.setDrawColor(165, 42, 42);
        pdf.setLineWidth(1.5);
        pdf.rect(startX, startY, gridWidth, gridWidth);

        for (let row = 0; row < gridSize; row++) {
          for (let col = 0; col < gridSize; col++) {
            const x = startX + col * cellSize;
            const y = startY + row * cellSize;
            const index = row * gridSize + col;
            const text = card[index] || '';

            pdf.setLineWidth(0.5);
            pdf.rect(x, y, cellSize, cellSize);

            if (text === 'FREI') {
              pdf.setFillColor(220, 240, 220);
              pdf.rect(x + 0.5, y + 0.5, cellSize - 1, cellSize - 1, 'F');
              pdf.setLineWidth(0.5);
              pdf.rect(x, y, cellSize, cellSize);
            }

            pdf.setTextColor(text === 'FREI' ? 34 : 0, text === 'FREI' ? 139 : 0, text === 'FREI' ? 34 : 0);
            const fontSize = Math.max(9, 16 - gridSize * 1.5);
            pdf.setFontSize(fontSize);

            const maxWidth = cellSize - 6;
            const lines = pdf.splitTextToSize(text, maxWidth);
            const lineHeight = fontSize * 0.4;
            const totalHeight = lines.length * lineHeight;
            const textStartY = y + (cellSize - totalHeight) / 2 + lineHeight;

            lines.forEach((line, i) => {
              pdf.text(line, x + cellSize / 2, textStartY + i * lineHeight, {
                align: 'center',
                maxWidth: maxWidth
              });
            });
          }
        }

        pdf.setFontSize(10);
        pdf.setTextColor(100, 100, 100);
        pdf.text(`Karte ${cardIndex + 1} von ${cards.length}`, 105, 280, { align: 'center' });
      });

      pdf.save('weihnachts-bingo-karten.pdf');
    }
  </script>
</body>
</html>
